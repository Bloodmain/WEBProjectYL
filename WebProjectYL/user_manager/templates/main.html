<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="{% static 'js/bootstrap.file-input.js' %}"></script>
    <title>Новости</title>
</head>
<body>
<header>
    <br>
    <nav>
        <div class="logo scalable">D&K</div>
        {% if user.is_authenticated %}
            <a href="/homepage/{{ user.id }}" class="scalable">Моя страница</a>
            <span class="scalable">|</span>
        {% else %}
            <a href="/homepage/unknown" class="scalable">Моя страница</a>
            <span class="scalable">|</span>
        {% endif %}
        <a href="/messages/" class="scalable">Сообщения</a> <span class="scalable">|</span>
        <a href="/" class="scalable">Новости</a>
        <div class="menu_btn scalable">Меню</div>
    </nav>
    <div class="burger">
        <div class="brick"></div>
        <div class="brick middle"></div>
        <div class="brick"></div>
    </div>
    <div class="menu">
        <a href="/friends/" class="menu_a">Друзья</a><br>
        <a href="/groups/" class="menu_a">Сообщества</a>
    </div>
    <br>
    {% block login %}
        <div class="log-btn">
            {% if user.is_authenticated %}
                <div>
                    <img src="{{ user.profile.avatar.url }}" alt="Аватарка" class="user_avatar">
                    <div class="user_info">
                        <div class="user_info_text">
                            {{ user.profile.name }} {{ user.profile.surname }}<br>
                            <a href="/logout/" class="logout btn btn-danger">Выйти</a>
                        </div>
                    </div>
                </div>
            {% else %}
                <p>
                    <a class="login btn btn-success" href="/login/">Войти</a><br>
                    <a class="register btn btn-primary " href="/register/">Зарегистрироваться</a>
                </p>
            {% endif %}
        </div>
    {% endblock %}
</header>
<div class="cont">
    {% block content %}
        {% if user.is_authenticated %}
            <form class="login-form" action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form }}
                <button type="submit" class="news_creation btn btn-primary">Создать</button>
            </form>
            <br>
        {% endif %}

        {% load index %}

        {% for news in all_news %}
            <div class="news">
                <a href="/homepage/{{ news.user.id }}" class="author_url">
                    <img src="{{ news.user.profile.avatar.url }}" alt="Аватарка"
                         class="news_avatar">
                    <span class="creator_name">{{ news.user.profile.name }} {{ news.user.profile.surname }}</span>
                </a>
                <span class="created_date">{{ news.create_date }}</span>

                <br><br>
                <div class="news_content">
                    {{ news.text_content }}<br><br>
                    <div class="images">
                        {% for image in images|index:forloop.counter0 %}
                            <img class="attach" src="{{ image.file.url }}"
                                 alt="Прикрепленное изображение"
                                 style="width: {{ widths|index:forloop.parentloop.counter0 }}%">
                        {% endfor %}
                    </div>
                </div>

                <div class="news_statistic">
                    <div class="likes">
                        <img class="like_img {{ news.post.id }}" alt="Сердце"
                             src="{% static 'img/unliked.png' %}">
                        <span class="likes_counter-{{ news.post.id }}">{{ news.post.total_likes }}</span>
                    </div>
                    <div class="comments-reposts">
                        <img class="comment-img" alt="Комментарий"
                             src="{% static 'img/comment.png' %}">
                        <img class="repost-img" alt="Репост" src="{% static 'img/repost.png' %}">
                    </div>
                </div>

                <hr class="line">
                <div class="comments">
                    {% if comments|index:forloop.counter0 %}
                        {% for comment in comments|index:forloop.counter0 %}
                            <a href="/homepage/{{ comment.user.id }}" class="author_url">
                                <img src="{{ comment.user.profile.avatar.url }}" alt="Аватарка"
                                     class="news_avatar comment-avatar">
                                <span class="creator_name">{{ comment.user.profile.name }} {{ comment.user.profile.surname }}</span>
                            </a>
                            <span class="created_date">{{ comment.create_date }}</span>

                            <div class="comment-text">
                                {{ comment.text }}
                            </div>

                            <br>
                        {% endfor %}
                    {% else %}
                        <span>Нет комментариев</span>
                    {% endif %}
                </div>
            </div>
            <br><br>
        {% endfor %}
    {% endblock %}
</div>
<script type="text/javascript" src="{% static 'js/script.js' %}"></script>
</body>
</html>